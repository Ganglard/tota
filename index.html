<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Commande d'Armes</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #18191a;
      color: #e4e4c3;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    h1, h2, h3 {
      text-align: center;
      color: #808000;
      margin-top: 30px;
      text-shadow: 0 2px 8px #3d3d00;
    }
    #armes, #munitions {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      justify-content: center;
      margin: 20px auto 10px auto;
      max-width: 1100px;
    }
    .arme-btn, .munition-btn {
      background: #23272b;
      border: 2px solid #a0b46a;
      border-radius: 14px;
      color: #e4e4c3;
      padding: 14px 18px 10px 18px;
      min-width: 120px;
      text-align: center;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.2s, border 0.2s, color 0.2s;
      box-shadow: 0 2px 8px #1a1d20;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .arme-btn:hover, .munition-btn:hover {
      background: #35391f;
      border-color: #bfcf87;
      color: #fffbe6;
    }
    .prix {
      color: #a0b46a;
      font-size: 0.98em;
      margin-top: 4px;
    }
    #panier, #formulaire-nom, #commandes {
      background: #23272b;
      border-radius: 18px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.5);
      margin: 20px auto;
      padding: 24px 32px;
      max-width: 600px;
      border: 2px solid #a0b46a;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    .panier-item {
      background: #262a2f;
      border-radius: 8px;
      margin-bottom: 8px;
      padding: 8px 14px;
      border-left: 4px solid #a0b46a;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .panier-controls {
      display: flex;
      align-items: center;
      gap: 3px;
    }
    .panier-btn {
      background: #a0b46a;
      color: #23272b;
      border: none;
      border-radius: 5px;
      font-size: 1.1em;
      font-weight: bold;
      width: 28px;
      height: 28px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      margin: 0 2px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .panier-btn:hover {
      background: #808000;
      color: #fff;
    }
    .remove-btn {
      background: #b94a48;
      color: #fff;
      border-radius: 50%;
      border: none;
      width: 22px;
      height: 22px;
      font-size: 1em;
      font-weight: bold;
      margin-left: 8px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .remove-btn:hover {
      background: #e74c3c;
    }
    button, .arme-btn, .munition-btn {
      font-family: inherit;
      font-weight: bold;
    }
    input[type="text"] {
      border-radius: 7px;
      border: 1.5px solid #bfcf87;
      padding: 7px 12px;
      margin-left: 8px;
      background: #18191a;
      color: #e4e4c3;
      outline: none;
      transition: border 0.2s;
    }
    input[type="text"]:focus {
      border: 2px solid #a0b46a;
      background: #23272b;
    }
    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      background: #23272b;
      border-radius: 12px;
      overflow: hidden;
      margin-top: 10px;
      border: 2px solid #a0b46a;
    }
    th, td {
      border: none;
      padding: 10px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #1a1d20;
      color: #808000;
      font-weight: bold;
      border-bottom: 2px solid #bfcf87;
    }
    tr:nth-child(even) td {
      background: #25282c;
    }
    tr:nth-child(odd) td {
      background: #23272b;
    }
    .reset-btn {
      background: #b94a48;
      color: #fff;
      border: none;
      padding: 8px 18px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 14px;
      transition: background 0.2s;
    }
    .reset-btn:hover {
      background: #e74c3c;
    }
  </style>
</head>
<body>
  <h1>Commande d'Armes GTA RP</h1>

  <h3>Armes</h3>
  <div id="armes"></div>

  <h3>Munitions</h3>
  <div id="munitions"></div>

  <div id="panier">
    <h2>Mon panier</h2>
    <ul id="liste-panier"></ul>
    <div id="total-panier" style="margin:10px 0 15px 0;font-weight:bold;color:#bfcf87;"></div>
    <button onclick="validerCommande()">Valider la commande</button>
  </div>

  <div id="formulaire-nom" style="display:none;">
    <h2>Finaliser la commande</h2>
    <label>Nom de l'acheteur : <input type="text" id="nom-acheteur"></label>
    <button onclick="enregistrerCommande()">Envoyer la commande</button>
  </div>

  <div id="commandes">
    <h2>Liste des commandes</h2>
    <button class="reset-btn" onclick="resetCommandes()">Réinitialiser les commandes de la semaine</button>
    <table>
      <thead>
        <tr><th>Nom de l'acheteur</th><th>Armes commandées</th><th>Total</th></tr>
      </thead>
      <tbody id="liste-commandes"></tbody>
    </table>
  </div>

  <script>
    // Séparation armes et munitions
    const armes = [
      { nom: "PETOIRE", prix_inter: 30000, prix_vente: 40000 },
      { nom: "BERETTA", prix_inter: 53000, prix_vente: 70000 },
      { nom: "GLOCK", prix_inter: 60000, prix_vente: 80000 },
      { nom: "P. LOURD", prix_inter: 102500, prix_vente: 135000 },
      { nom: "TEC 9", prix_inter: 320000, prix_vente: 420000 },
      { nom: "SKORPION", prix_inter: 320000, prix_vente: 420000 },
      { nom: "OLD SCIE", prix_inter: 375000, prix_vente: 485000 },
      { nom: "486 SCIE", prix_inter: 450500, prix_vente: 585000 },
      { nom: "UZI", prix_inter: 700000, prix_vente: 800000 },
      { nom: "AK U", prix_inter: 1050000, prix_vente: 1350000 },
      { nom: "AK 47", prix_inter: 1695842, prix_vente: 2200000 }
    ];

    const munitions = [
      { nom: "45 ACP", prix_inter: 4000, prix_vente: 4500 },
      { nom: "9MM", prix_inter: 4500, prix_vente: 5500 },
      { nom: "CAL 12", prix_inter: 6200, prix_vente: 7500 },
      { nom: "7MM / 7.62", prix_inter: 6500, prix_vente: 8000 }
    ];

    let typePrix = "inter"; // ou "vente"
    let panier = [];

    // Charge les commandes sauvegardées au démarrage
    let commandes = JSON.parse(localStorage.getItem('commandesGTA')) || [];

    function afficherArmes() {
      const div = document.getElementById('armes');
      div.innerHTML = '';
      armes.forEach(arme => {
        const prix = arme.prix_inter.toLocaleString() + '$';
        const btn = document.createElement('div');
        btn.className = 'arme-btn';
        btn.onclick = () => ajouterAuPanier(arme.nom);
        btn.innerHTML = `<span>${arme.nom}</span><span class="prix">${prix}</span>`;
        div.appendChild(btn);
      });
    }

    function afficherMunitions() {
      const div = document.getElementById('munitions');
      div.innerHTML = '';
      munitions.forEach(mun => {
        const prix = mun.prix_inter.toLocaleString() + '$';
        const btn = document.createElement('div');
        btn.className = 'munition-btn';
        btn.onclick = () => ajouterAuPanier(mun.nom);
        btn.innerHTML = `<span>${mun.nom}</span><span class="prix">${prix}</span>`;
        div.appendChild(btn);
      });
    }

    function ajouterAuPanier(nom) {
      panier.push(nom);
      afficherPanier();
    }

    function modifierQuantite(nom, delta) {
      const index = panier.findIndex(item => item === nom);
      if (delta === -1) {
        // Retire un exemplaire
        if (index !== -1) panier.splice(index, 1);
      } else if (delta === 1) {
        panier.push(nom);
      }
      afficherPanier();
    }

    function supprimerDuPanier(nom) {
      panier = panier.filter(item => item !== nom);
      afficherPanier();
    }

    function afficherPanier() {
      const ul = document.getElementById('liste-panier');
      ul.innerHTML = '';
      const compteur = {};
      let total = 0;
      panier.forEach(nom => {
        if (compteur[nom]) {
          compteur[nom]++;
        } else {
          compteur[nom] = 1;
        }
      });
      Object.entries(compteur).forEach(([nom, quantite]) => {
        let item = armes.find(a => a.nom === nom) || munitions.find(m => m.nom === nom);
        const prix = typePrix === "inter" ? (item ? item.prix_inter : 0) : (item ? item.prix_vente : 0);
        const li = document.createElement('li');
        li.className = 'panier-item';
        li.innerHTML = `
          <span>${nom} - ${prix.toLocaleString()}$</span>
          <div class="panier-controls">
            <button class="panier-btn" onclick="modifierQuantite('${nom}',-1)" title="Retirer un">−</button>
            <span style="min-width:22px;text-align:center;">${quantite}</span>
            <button class="panier-btn" onclick="modifierQuantite('${nom}',1)" title="Ajouter un">+</button>
            <button class="remove-btn" onclick="supprimerDuPanier('${nom}')" title="Supprimer"><span>&times;</span></button>
            <span style="margin-left:10px; color:#a0b46a;">${(prix * quantite).toLocaleString()}$</span>
          </div>
        `;
        ul.appendChild(li);
        total += prix * quantite;
      });
      document.getElementById('total-panier').textContent = total > 0 ? `Total : ${total.toLocaleString()}$` : '';
    }

    function validerCommande() {
      if (panier.length === 0) {
        alert("Votre panier est vide !");
        return;
      }
      document.getElementById('formulaire-nom').style.display = 'block';
    }

    function enregistrerCommande() {
      const nom = document.getElementById('nom-acheteur').value.trim();
      if (!nom) {
        alert("Veuillez entrer le nom de l'acheteur.");
        return;
      }
      // Création de la commande à sauvegarder
      const nouvelleCommande = { nom, items: [...panier] };

      // Récupère les commandes déjà enregistrées dans le localStorage
      let commandesSauvegardees = JSON.parse(localStorage.getItem('commandesGTA')) || [];

      // Ajoute la nouvelle commande
      commandesSauvegardees.push(nouvelleCommande);

      // Sauvegarde le tout dans le localStorage
      localStorage.setItem('commandesGTA', JSON.stringify(commandesSauvegardees));

      // Continue le process normal
      commandes.push(nouvelleCommande);
      panier = [];
      afficherPanier();
      afficherCommandes();
      document.getElementById('formulaire-nom').style.display = 'none';
      document.getElementById('nom-acheteur').value = '';
      alert("Commande enregistrée !");
    }

    function afficherCommandes() {
      const tbody = document.getElementById('liste-commandes');
      tbody.innerHTML = '';
      commandes.forEach(cmd => {
        const compteur = {};
        let total = 0;
        cmd.items.forEach(nom => {
          if (compteur[nom]) {
            compteur[nom]++;
          } else {
            compteur[nom] = 1;
          }
        });
        const itemsAffichees = Object.entries(compteur)
          .map(([nom, quantite]) => {
            let item = armes.find(a => a.nom === nom) || munitions.find(m => m.nom === nom);
            const prix = typePrix === "inter" ? (item ? item.prix_inter : 0) : (item ? item.prix_vente : 0);
            total += prix * quantite;
            return quantite > 1
              ? `${nom} x${quantite} - ${(prix * quantite).toLocaleString()}$`
              : `${nom} - ${prix.toLocaleString()}$`;
          })
          .join('<br>');
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${cmd.nom}</td><td>${itemsAffichees}</td><td>${total.toLocaleString()}$</td>`;
        tbody.appendChild(tr);
      });
    }

    function resetCommandes() {
      if (confirm("Es-tu sûr de vouloir supprimer toutes les commandes de la semaine ?")) {
        localStorage.removeItem('commandesGTA');
        commandes = [];
        afficherCommandes();
        alert("Toutes les commandes ont été supprimées !");
      }
    }

    // Rendez les fonctions accessibles globalement
    window.modifierQuantite = modifierQuantite;
    window.supprimerDuPanier = supprimerDuPanier;
    window.validerCommande = validerCommande;
    window.enregistrerCommande = enregistrerCommande;
    window.resetCommandes = resetCommandes;

    // Initialisation
    afficherArmes();
    afficherMunitions();
    afficherPanier();
    afficherCommandes();
  </script>
</body>
</html>
